<!DOCTYPE html>
<html>
    <head>
        <meta charset ="UTF-8">
        <title>Calculator</title>
        <style>
            #container {
                height: 750px;
                width: 600px;
                margin: 100px auto;
                border: 20px solid black;
                background-color: goldenrod;
            }
            #calcDisplay {
                margin: 40px 60px 50px;
                padding: 10px;
                height: 50px;
                width: auto;
                border: 10px solid black;
                font-size: 50px;
                font-family: "Courier New", Courier, monospace;
                font-weight: bold;
                text-align: right;
                background-color: lightgray;
            }
            #buttonRowContainer {
                margin: 10px;
                text-align: center;
            }
            .calcButton {
                cursor: pointer;
                background-color: greenyellow;
                width: 40px;
                height: 40px;
                border: 10px solid purple;
                padding: 10px;
                margin: 5px;
                line-height: 40px;
                font-size: 30px;
                font-family: "Courier New", Courier, monospace;
                font-weight: bold;
                display: inline-block;
            }
            .calcWideButton {
                width: 135px;
            }
            .calcOperationButton {
                background-color: yellow;
            }
            .calcEqualsButton {
                background-color: orange;
            }
            .calcClearButton {
                background-color: lightblue;
            }
            .calcSignButton {
                font-size: 20px;
            }
            .calcButton:hover {
                background-color: orangered;
            }
            .calcButton:active {
                background-color: orangered;
                transform: translate(4px, -4px);
            }

        </style>
    </head>
    <body>
        <div id="container">
            <div id="calcDisplay"></div>
            <div id="buttonRowContainer">
                <div onclick="clearAll()" class="calcButton calcClearButton">AC</div>
                <div onclick="clearLast()" class="calcButton calcClearButton">C</div>
                <div onclick="flipSign()" class="calcButton calcSignButton">+/-</div>
                <div onclick="inputOperator('divide')" class="calcButton calcOperationButton">/</div>
            </div>
            <div id="buttonRowContainer">
                <div onclick="inputNumber(7)" class="calcButton">7</div>
                <div onclick="inputNumber(8)" class="calcButton">8</div>
                <div onclick="inputNumber(9)" class="calcButton">9</div>
                <div onclick="inputOperator('multiply')" class="calcButton calcOperationButton">*</div>
            </div>
            <div id="buttonRowContainer">
                <div onclick="inputNumber(4)" class="calcButton">4</div>
                <div onclick="inputNumber(5)" class="calcButton">5</div>
                <div onclick="inputNumber(6)" class="calcButton">6</div>
                <div onclick="inputOperator('subtract')" class="calcButton calcOperationButton">-</div>
            </div>
            <div id="buttonRowContainer">
                <div onclick="inputNumber(1)" class="calcButton">1</div>
                <div onclick="inputNumber(2)" class="calcButton">2</div>
                <div onclick="inputNumber(3)" class="calcButton">3</div>
                <div onclick="inputOperator('add')" class="calcButton calcOperationButton">+</div>
            </div>
            <div id="buttonRowContainer">
                <div onclick="inputNumber(0)" class="calcButton calcWideButton">0</div>
                <div onclick="addDecimal()" class="calcButton">.</div>
                <div onclick="operateOnStacks(inputStack, outputStack, lastValue)"
                        class="calcButton calcEqualsButton">=</div>
            </div>
        </div>
        <script>       

            document.addEventListener("keydown", (e) => {
                if (e.keyCode === 48) {inputNumber(0)}
                if (e.keyCode === 49) {inputNumber(1)}
                if (e.keyCode === 50) {inputNumber(2)}
                if (e.keyCode === 51) {inputNumber(3)}
                if (e.keyCode === 52) {inputNumber(4)}
                if (e.keyCode === 53) {inputNumber(5)}
                if (e.keyCode === 54) {inputNumber(6)}
                if (e.keyCode === 55) {inputNumber(7)}
                if (e.keyCode === 56 && !e.shiftKey) {inputNumber(8)}
                if (e.keyCode === 57) {inputNumber(9)}
                if (e.keyCode === 61 && e.shiftKey) {inputOperator("add")}
                if (e.keyCode === 173) {inputOperator("subtract")}
                if (e.keyCode === 56 && e.shiftKey) {inputOperator("multiply")}
                if (e.keyCode === 191) {inputOperator("divide")}
                if (e.keyCode === 61 && !e.shiftKey) {operateOnStacks(inputStack, outputStack, lastValue)}
                if (e.keyCode === 65) {clearAll()}
                if (e.keyCode === 67) {clearLast()}
                if (e.keyCode === 192) {flipSign()}
                if (e.keyCode === 190) {addDecimal()}
            });


            let inputStack = [];    // numbers and operators are loaded here as buttons are pressed
            let outputStack = [];   // this is populated from inputStack when equals is pressed
            let lastButtonPressed = ""; // stores the last button pressed on the calculator
            let lastValue = ""; // stores the last recorded value (number or operator)
            let newValue = "";  // stores the value to start new calculations after equals is pressed
            let errorFlag = ""; // stores "Error" if division by zero has just been attempted
            let decimalFlag = ""; // stores "Decimal" if lastValue contains a number with a decimal point

            const displayLength = 11; // the number of number characters allowed to be displayed
            const exponentialLength = 7;  // the number of number characters allowed in scientific notation

            clearDisplay();
            
            let add = (a, b) => a + b;
            let subtract = (a, b) => a - b;
            let multiply = (a, b) => a * b;
            let divide = (a, b) => a / b;
            
            function operate(operator, a, b) {
                let result;
                switch (operator) {
	                case "add": result = add(a, b); break;
	                case "subtract": result = subtract(a, b); break;
	                case "multiply": result = multiply(a, b); break;
	                case "divide": result = divide(a, b); break
                }
                return result;
            }
            
            function clearDisplay() {
                calcDisplay.innerHTML = "0";
            }

            function clearVars() {
                inputStack = [];
                outputStack = [];
                lastValue = "";
                lastButtonPressed = "";
                decimalFlag = "";
            }

            function clearAll() {
                newValue = "";
                clearVars();
                clearDisplay();
            }

            function clearLast(){
                lastValue = "";
                clearDisplay();
            }

            function inputNumber (digit) {
                errorFlag = "";
                if (lastValue.toString().length < displayLength) {
                    if (lastButtonPressed === "") {
                        lastValue = digit;
                    } else if (lastButtonPressed === ".") {
                        lastValue = parseFloat(lastValue + digit);
                    } else if (typeof(lastButtonPressed) === "number") {
                        lastValue = parseFloat(lastValue.toString() + digit);
                    } else {
                        inputStack.push(lastValue);
                        lastValue = digit;
                    }
                    populateDisplay(lastValue);
                    lastButtonPressed = digit;
                }
            }
            
            function inputOperator (str) {
                decimalFlag = "";
                if (errorFlag !== "Error") {
                    if (lastButtonPressed === "") {
                        if (newValue !== "") {
                            inputStack.push(newValue);
                        } else {
                            return;
                        }
                    }
                    if (typeof(lastButtonPressed) === "number") {
                        inputStack.push(lastValue);
                        lastValue = str;
                    } else {
                        lastValue = str;
                    }
                    lastButtonPressed = str;
                }
            }

            function populateDisplay(displayValue) {
                if (displayValue !== "Error") {
                    displayValue = parseFloat(displayValue.toPrecision(displayLength));
                    if (Math.round(displayValue).toString().length > displayLength) {
                        displayValue = displayValue.toExponential(exponentialLength);
                    }
                }
                calcDisplay.innerHTML = displayValue;
            }

            function populateOutputStack(lastValue) {
                inputStack.push(lastValue);
                while (inputStack.length > 0) {
                    let x = inputStack.shift()
                    if (typeof(x) === "number") {
                        if (outputStack[outputStack.length - 1] === "multiply" ||
                                outputStack[outputStack.length - 1] === "divide") {
                            let operator = outputStack.pop();
                            let a = outputStack.pop();
                            if (x === 0) {
                                populateDisplay("Error");
                                errorFlag = "Error";
                                return;
                            }
                            x = operate(operator, a, x);
                            outputStack.push(x);
                        } else {
                            outputStack.push(x);
                        }
                    } else {
                        outputStack.push(x);
                    }
                }
            }

            function evaluateOutputStack() {
                while (outputStack.length >= 3) {
                    let a = outputStack.shift();
                    let operator = outputStack.shift();
                    let b = outputStack.shift();
                    let x = operate(operator, a, b);
                    outputStack.unshift(x);
                }
            }

            function operateOnStacks(inputStack, outputStack, lastValue) {
                if (typeof(lastValue) !== "number") {
                    return;
                }
                if (inputStack.length === 0) {
                    return;
                }
                populateOutputStack(lastValue);
                evaluateOutputStack();
                if (errorFlag === "Error") {
                    return;
                }
                populateDisplay(outputStack[0]);
                newValue = outputStack[0];
                clearVars();
            }

            function flipSign() {
                if (lastValue === "") {
                    newValue = newValue * -1;
                    populateDisplay(newValue);
                } else if (typeof(lastValue) === "number") {
                    lastValue = lastValue * -1;
                    populateDisplay(lastValue);
                }
            }

            function addDecimal() {
                populateDisplay
                if (decimalFlag !== "Decimal") {
                    if (typeof(lastButtonPressed) === "number") {
                        lastValue = (lastValue.toString() + ".");
                    } else {
                        lastValue = "0.";
                    }
                    calcDisplay.innerHTML = lastValue;
                    decimalFlag = "Decimal";
                    lastButtonPressed = ".";
                }
            }

        </script>
    </body>
</html>